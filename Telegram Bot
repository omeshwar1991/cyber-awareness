import pyodbc
from telegram import Update
from telegram.ext import Application, CommandHandler, MessageHandler, filters, ContextTypes

# üõ°Ô∏è Replace this with your real Telegram bot token
BOT_TOKEN = '7391219082:AAFmpErGUpQVrLVYhqsoQ9WudJPULe-lRLQ'

# üîó Replace with your actual SQL Server connection string
MSSQL_CONN_STR = (
    'DRIVER={ODBC Driver 17 for SQL Server};'
    'SERVER=OMESHWAR-PC;'
    'DATABASE=Netram_SDR;'
    'UID=Omeshwar;'
    'PWD=Omeshwar;'
    'Trusted_Connection=yes;'
)

# üîç Search function
def search_mobile(mobile_number):
    conn = pyodbc.connect(MSSQL_CONN_STR)
    cursor = conn.cursor()
    cursor.execute("SELECT * FROM tbl_Omeshwar_SDR WHERE Mobile = ?", (mobile_number,))
    result = cursor.fetchone()
    conn.close()
    return result

# üì© Start Command
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text("Send me a 10 digits Mobile Number to get SDR.\n\nCyber Hawk\nCyber Crime Police Station\nGandhinagar Range")

# üì¶ Handle Mobile Number Input
async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    mobile_number = update.message.text.strip()

    if not mobile_number.isdigit():
        await update.message.reply_text("Please send only 10 digits Mobile Number to get SDR.\n\nCyber Hawk\nCyber Crime Police Station\nGandhinagar Range")
        return

    result = search_mobile(mobile_number)
    if result:
        await update.message.reply_text(f"SDR of Mobile: {result[0]}\nName: {result[1]}\nAddress: {result[2]}\nState-UT: {result[3]}\nPin Code: {result[4]} \nDate of Birth: {result[6]} \nID Proof: {result[7]} {result[8]} \nSim Act Date: {result[12]} \nOperator: {result[13]} \nOperator State: {result[14]}\nAlt Mobile:{result[9]}\n\nCyber Hawk\nCyber Crime Police Station\nGandhinagar Range")
    else:
        await update.message.reply_text("No SDR data found.")

# ‚ñ∂Ô∏è Main function to run the bot
def main():
    app = Application.builder().token(BOT_TOKEN).build()

    app.add_handler(CommandHandler("start", start))
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))

    print("Cyber Hawk Bot is running...")
    app.run_polling()

if __name__ == "__main__":
    main()
