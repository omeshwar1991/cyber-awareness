<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Numerology ‚Äî Name + DOB (With Lucky Number & Color)</title>

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
  :root{
    --bg: #121212; --text:#e8e8e8; --card:#1e1e1e; --accent:#64b5f6; --input:#2c2c2c;
  }
  body.light { --bg:#f7f9fc; --text:#1f1f1f; --card:#ffffff; --accent:#1976d2; --input:#ffffff; }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: "Segoe UI", Roboto, Arial, sans-serif;
    padding: 24px;
    transition: background .3s, color .3s;
  }
  .card-main {
    max-width: 880px;
    margin: 8px auto;
    background: var(--card);
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.35);
  }
  h1 { color: var(--accent); font-weight:600; }
  input, select { background: var(--input); color: var(--text); border:1px solid rgba(255,255,255,0.06); }
  .theme-btn {
    position: fixed; right: 18px; top: 18px;
    background: var(--accent); color: white; border: none; padding: 8px 12px; border-radius: 999px; cursor:pointer;
    z-index: 9999;
  }
  .result-box { margin-top: 18px; background: rgba(255,255,255,0.02); padding: 16px; border-radius:10px; }
  .section { margin-top:10px; padding:10px; border-radius:8px; background: rgba(0,0,0,0.06); }
  .muted { color: #bdbdbd; font-size: 0.95rem; }
  b { color: var(--accent); }
  .download-btn { margin-right:8px; }
  .label-sm { font-size:0.95rem; color: #bdbdbd; }
  .color-pill { display:inline-block; padding:6px 10px; border-radius:20px; color:#fff; margin-right:8px; font-weight:600; }
  @media (max-width:575px){
    .card-main { padding: 16px; }
  }
</style>
</head>
<body>

<button class="theme-btn" id="themeToggle">üåô Dark</button>

<div class="card-main">
  <div class="text-center">
    <h1>üî¢ Numerology ‚Äî Name + DOB</h1>
    <p class="muted">‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§ú‡§®‡•ç‡§Æ‡§§‡§ø‡§•‡§ø ‡§°‡§æ‡§≤‡•á‡§Ç ‚Äî ‡§Ö‡§¨ Lucky Number & Lucky Color ‡§¶‡•ã‡§®‡•ã‡§Ç combined ‡§§‡§∞‡•Ä‡§ï‡•á ‡§∏‡•á ‡§Æ‡§ø‡§≤‡•á‡§Ç‡§ó‡•á</p>
  </div>

  <div class="row g-3 align-items-end">
    <div class="col-md-7">
      <label class="form-label">‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ / Full name</label>
      <input id="nameInput" class="form-control" placeholder="‡§â‡§¶‡§æ‡§π‡§∞‡§£ / e.g.: Devanshi Patel" />
    </div>

    <div class="col-md-3">
      <label class="form-label">‡§ú‡§®‡•ç‡§Æ‡§§‡§ø‡§•‡§ø (DOB) / Date of Birth</label>
      <input id="dobInput" type="date" class="form-control" />
    </div>

    <div class="col-md-2 text-end">
      <button class="btn btn-primary w-100" onclick="calculateAll()">Calculate</button>
    </div>
  </div>

  <div id="result" class="result-box" style="display:none;">
    <div id="letters" class="label-sm"></div>

    <div class="row mt-2">
      <div class="col-md-6">
        <div id="nameTotal" class="fs-6"></div>
        <div id="meaningName" class="section"></div>
      </div>
      <div class="col-md-6">
        <div id="lifeTotal" class="fs-6"></div>
        <div id="meaningLife" class="section"></div>
      </div>
    </div>

    <div id="compat" class="section mt-3"></div>

    <div id="luckyBlock" class="section mt-3"></div>

    <div id="actionPlan" class="section mt-3"></div>

    <div class="d-flex flex-wrap justify-content-center mt-3">
      <button class="btn btn-sm download-btn" onclick="downloadPDF()">üìÑ Save as PDF / PDF ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§°</button>
      <button class="btn btn-sm download-btn" onclick="downloadImage()">üì∏ Save as Image / PNG ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§°</button>
      <button class="btn btn-sm btn-outline-light ms-1" onclick="copyResult()">üîó Copy Text / ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡•á‡§Ç</button>
    </div>
  </div>

  <div class="mt-3 muted">
    <small>
      ‡§®‡•ã‡§ü: Lucky Color ‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï‡§§‡§æ: (1) ‡§Ö‡§ó‡§∞ ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§¨‡§∞‡§æ‡§¨‡§∞ ‡§π‡•ã‡§Ç ‡§§‡•ã ‡§µ‡§π‡•Ä, (2) ‡§Ö‡§ó‡§∞ ‡§ï‡•ã‡§à Master ‡§π‡•ã ‡§§‡•ã Master ‡§ï‡§æ ‡§∞‡§Ç‡§ó ‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï, (3) ‡§Ö‡§®‡•ç‡§Ø‡§•‡§æ Life Path ‡§ï‡§æ ‡§∞‡§Ç‡§ó ‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï ‚Äî ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§∞‡§Ç‡§ó ‡§≠‡•Ä ‡§¶‡§ø‡§ñ‡•á‡§Ç‡§ó‡•á‡•§  
    </small>
  </div>
</div>

<!-- libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
/* ---------- mapping & data ---------- */
const mapping = {
  'A':1,'I':1,'J':1,'Q':1,'Y':1,
  'B':2,'K':2,'R':2,
  'C':3,'G':3,'L':3,'S':3,
  'D':4,'M':4,'T':4,
  'E':5,'H':5,'N':5,'X':5,
  'U':6,'V':6,'W':6,
  'O':7,'Z':7,
  'F':8,'P':8
};

const MASTERS = [11,22,33];

const data = {
  1:{ color_hi:"‡§≤‡§æ‡§≤", color_en:"Red", color_hex:"#C62828", meaning_hi:"‡§®‡•á‡§§‡•É‡§§‡•ç‡§µ, ‡§Ü‡§§‡•ç‡§Æ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏‡•Ä ‡§î‡§∞ ‡§®‡§à ‡§∂‡•Å‡§∞‡•Å‡§Ü‡§§‡•§", meaning_en:"Leadership, confidence and fresh starts.", profession:"Leader, Entrepreneur" },
  2:{ color_hi:"‡§∏‡§´‡•á‡§¶", color_en:"White", color_hex:"#FAFAFA", meaning_hi:"‡§∏‡§π‡§Ø‡•ã‡§ó‡•Ä, ‡§∏‡§Ç‡§µ‡•á‡§¶‡§®‡§∂‡•Ä‡§≤ ‡§î‡§∞ ‡§∏‡§Ç‡§§‡•Å‡§≤‡§® ‡§™‡•ç‡§∞‡§ø‡§Ø‡•§", meaning_en:"Cooperative, sensitive and balance-oriented.", profession:"Counselor, Teacher" },
  3:{ color_hi:"‡§™‡•Ä‡§≤‡§æ", color_en:"Yellow", color_hex:"#F9A825", meaning_hi:"‡§∞‡§ö‡§®‡§æ‡§§‡•ç‡§Æ‡§ï ‡§î‡§∞ ‡§Ö‡§≠‡§ø‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§™‡•Ç‡§∞‡•ç‡§£‡•§", meaning_en:"Creative, expressive and joyful.", profession:"Artist, Writer" },
  4:{ color_hi:"‡§®‡•Ä‡§≤‡§æ", color_en:"Blue", color_hex:"#1565C0", meaning_hi:"‡§Æ‡•á‡§π‡§®‡§§‡•Ä, ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§ø‡§§ ‡§î‡§∞ ‡§≠‡§∞‡•ã‡§∏‡•á‡§Æ‡§Ç‡§¶‡•§", meaning_en:"Hardworking, practical and reliable.", profession:"Engineer, Researcher" },
  5:{ color_hi:"‡§´‡§ø‡§∞‡•ã‡§ú‡§º‡•Ä", color_en:"Turquoise", color_hex:"#00897B", meaning_hi:"‡§∏‡•ç‡§µ‡§§‡§Ç‡§§‡•ç‡§∞, ‡§∏‡§æ‡§π‡§∏‡•Ä ‡§î‡§∞ ‡§™‡§∞‡§ø‡§µ‡§∞‡•ç‡§§‡§®‡§∂‡•Ä‡§≤‡•§", meaning_en:"Independent, adventurous and adaptable.", profession:"Marketing, Media" },
  6:{ color_hi:"‡§π‡§∞‡§æ", color_en:"Green", color_hex:"#2E7D32", meaning_hi:"‡§™‡•ã‡§∑‡§ï, ‡§∏‡•å‡§Ç‡§¶‡§∞‡•ç‡§Ø ‡§î‡§∞ ‡§ú‡§ø‡§Æ‡•ç‡§Æ‡•á‡§¶‡§æ‡§∞‡•Ä‡•§", meaning_en:"Nurturing, responsible and family-oriented.", profession:"Doctor, Designer" },
  7:{ color_hi:"‡§∏‡§´‡•á‡§¶/‡§π‡§≤‡•ç‡§ï‡§æ ‡§π‡§∞‡§æ", color_en:"White/Light Green", color_hex:"#9CCC65", meaning_hi:"‡§Ü‡§ß‡•ç‡§Ø‡§æ‡§§‡•ç‡§Æ‡§ø‡§ï, ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§ï ‡§î‡§∞ ‡§∂‡•ã‡§ß‡§™‡•ç‡§∞‡§ø‡§Ø‡•§", meaning_en:"Spiritual, analytical and introspective.", profession:"Research, Spiritual" },
  8:{ color_hi:"‡§ï‡§æ‡§≤‡§æ/‡§ó‡§π‡§∞‡§æ ‡§®‡•Ä‡§≤‡§æ", color_en:"Black/Dark Blue", color_hex:"#0D47A1", meaning_hi:"‡§ß‡§®, ‡§∂‡§ï‡•ç‡§§‡§ø ‡§î‡§∞ ‡§∏‡§´‡§≤‡§§‡§æ ‡§ï‡§æ ‡§∏‡§Ç‡§ï‡•á‡§§‡•§", meaning_en:"Powerful, ambitious and success-oriented.", profession:"Business, Finance" },
  9:{ color_hi:"‡§∏‡•Å‡§®‡§π‡§∞‡§æ", color_en:"Golden", color_hex:"#FFC107", meaning_hi:"‡§∏‡•á‡§µ‡§æ, ‡§ï‡§∞‡•Å‡§£‡§æ ‡§î‡§∞ ‡§µ‡•ç‡§Ø‡§æ‡§™‡§ï ‡§¶‡•É‡§∑‡•ç‡§ü‡§ø‡•§", meaning_en:"Compassionate, service-minded and humanitarian.", profession:"Medical, Social Work" },
  11:{ color_hi:"‡§∏‡§´‡•á‡§¶", color_en:"White", color_hex:"#E3F2FD", meaning_hi:"Master 11: ‡§â‡§ö‡•ç‡§ö ‡§Ü‡§ß‡•ç‡§Ø‡§æ‡§§‡•ç‡§Æ‡§ø‡§ï‡§§‡§æ ‡§î‡§∞ ‡§™‡•ç‡§∞‡•á‡§∞‡§£‡§æ‡•§", meaning_en:"Master 11: heightened intuition and inspiration.", profession:"Spiritual Teacher" },
  22:{ color_hi:"‡§ó‡§π‡§∞‡§æ ‡§®‡•Ä‡§≤‡§æ", color_en:"Dark Blue", color_hex:"#0D47A1", meaning_hi:"Master 22: ‡§¨‡§ø‡§≤‡•ç‡§°‡§∞ ‚Äî ‡§¨‡§°‡§º‡§æ ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡•§", meaning_en:"Master 22: master builder, practical large-scale achievements.", profession:"Architect, Business Leader" },
  33:{ color_hi:"‡§∏‡•Å‡§®‡§π‡§∞‡§æ", color_en:"Golden", color_hex:"#FFD54F", meaning_hi:"Master 33: ‡§∏‡•á‡§µ‡§æ ‡§ï‡§æ ‡§â‡§ö‡•ç‡§ö ‡§∞‡•Ç‡§™‡•§", meaning_en:"Master 33: master teacher of compassion and service.", profession:"Philanthropy, Teaching" }
};

/* ---------- helpers ---------- */
function reduceWithMasters(n) {
  n = Math.abs(Math.floor(n || 0));
  if (MASTERS.includes(n)) return n;
  while (n > 9) {
    let s = 0;
    while (n > 0) { s += n % 10; n = Math.floor(n/10); }
    if (MASTERS.includes(s)) return s;
    n = s;
  }
  return n === 0 ? 0 : n;
}

function calculateNameNumber(fullName) {
  const cleaned = (fullName || "").toUpperCase().replace(/[^A-Z]/g, '');
  let total = 0;
  const breakdown = [];
  for (const ch of cleaned) {
    const v = mapping[ch] || 0;
    breakdown.push(`${ch}=${v}`);
    total += v;
  }
  const reduced = reduceWithMasters(total);
  return { total, reduced, breakdown };
}

function calculateLifePathFromDate(isoDate) {
  if (!isoDate) return null;
  const [y,m,d] = isoDate.split('-');
  const digits = (d + m + y).replace(/[^0-9]/g,'').split('').map(Number);
  const sum = digits.reduce((a,b)=>a+b,0);
  const reduced = reduceWithMasters(sum);
  return { sum, reduced, digits };
}

/* ---------- Combined Lucky logic ---------- */
function determineLucky(nameNum, lifeNum) {
  // returns object with primaryNumber, secondaryNumber (maybe null), primaryColor info, secondaryColor info, explanation (hi/en)
  if (!nameNum && !lifeNum) return null;

  // if both equal -> primary is that
  if (nameNum === lifeNum) {
    const col = data[nameNum] || {};
    return {
      primaryNumber: nameNum,
      secondaryNumber: null,
      primaryColorHi: col.color_hi || '-',
      primaryColorEn: col.color_en || '-',
      primaryColorHex: col.color_hex || '#777',
      explanationHi: `Name Number ‡§î‡§∞ Life Path Number ‡§¶‡•ã‡§®‡•ã‡§Ç ${nameNum} ‡§π‡•à‡§Ç ‚Äî ‡§Ø‡§π ‡§Ü‡§™‡§ï‡§æ ‡§Æ‡•Å‡§ñ‡•ç‡§Ø Lucky Number ‡§π‡•à‡•§`,
      explanationEn: `Your Name Number and Life Path Number are both ${nameNum} ‚Äî this is your primary Lucky Number.`
    };
  }

  // if any is master -> prioritize master
  const nameIsMaster = MASTERS.includes(nameNum);
  const lifeIsMaster = MASTERS.includes(lifeNum);
  if (nameIsMaster || lifeIsMaster) {
    const masterNum = nameIsMaster ? nameNum : lifeIsMaster ? lifeNum : null;
    const otherNum = masterNum === nameNum ? lifeNum : nameNum;
    const colMaster = data[masterNum] || {};
    const colOther = data[otherNum] || {};
    return {
      primaryNumber: masterNum,
      secondaryNumber: otherNum,
      primaryColorHi: colMaster.color_hi || '-',
      primaryColorEn: colMaster.color_en || '-',
      primaryColorHex: colMaster.color_hex || '#777',
      secondaryColorHi: colOther.color_hi || '-',
      secondaryColorEn: colOther.color_en || '-',
      secondaryColorHex: colOther.color_hex || '#aaa',
      explanationHi: `Master Number (${masterNum}) ‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§π‡•à ‚Äî ‡§á‡§∏‡•á ‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï Lucky Number ‡§Æ‡§æ‡§®‡•á‡§Ç; ‡§¶‡•Ç‡§∏‡§∞‡§æ ‡§®‡§Ç‡§¨‡§∞ ‡§∏‡§π‡§æ‡§Ø‡§ï ‡§π‡•à‡•§`,
      explanationEn: `A Master Number (${masterNum}) is present ‚Äî treat it as the primary Lucky Number; the other number is secondary.`
    };
  }

  // otherwise prefer Life Path as primary (user's life path often guides)
  const primary = lifeNum || nameNum;
  const secondary = (primary === lifeNum) ? nameNum : lifeNum;
  const colP = data[primary] || {};
  const colS = data[secondary] || {};
  return {
    primaryNumber: primary,
    secondaryNumber: secondary,
    primaryColorHi: colP.color_hi || '-',
    primaryColorEn: colP.color_en || '-',
    primaryColorHex: colP.color_hex || '#777',
    secondaryColorHi: colS.color_hi || '-',
    secondaryColorEn: colS.color_en || '-',
    secondaryColorHex: colS.color_hex || '#aaa',
    explanationHi: `Life Path (${primary}) ‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï ‡§π‡•à ‚Äî ‡§á‡§∏‡•á ‡§Ö‡§™‡§®‡§æ ‡§Æ‡•Å‡§ñ‡•ç‡§Ø Lucky Number ‡§Æ‡§æ‡§®‡•á‡§Ç; ‡§®‡§æ‡§Æ ‡§Ö‡§Ç‡§ï (${secondary}) ‡§∏‡§π‡§æ‡§Ø‡§ï ‡§π‡•à‡•§`,
    explanationEn: `Life Path (${primary}) is primary ‚Äî consider it your main Lucky Number; the Name number (${secondary}) is supportive.`
  };
}

/* ---------- Action plan generator (simple) ---------- */
function generateActionPlan(nameNum, lifeNum) {
  const plan = [];
  if (nameNum) plan.push({ hi:`(Name) ‡§Ö‡§™‡§®‡•á ‡§®‡§æ‡§Æ ‡§ï‡•Ä ‡§§‡§æ‡§ï‡§§ (#${nameNum}) ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞ ‡§ï‡•á ‡§è‡§ï ‡§õ‡•ã‡§ü‡§æ ‡§™‡•ç‡§∞‡•ã‡§ú‡§º‡•á‡§ï‡•ç‡§ü ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç‡•§`, en:`(Name) Use your name strength (#${nameNum}) to start one small project.`});
  if (lifeNum) plan.push({ hi:`(Life) ‡§Ö‡§™‡§®‡•á ‡§ú‡•Ä‡§µ‡§® ‡§™‡§• (#${lifeNum}) ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ 1-3 ‡§Æ‡§π‡•Ä‡§®‡•á ‡§ï‡•á ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø ‡§¨‡§®‡§æ‡§è‡§Ç‡•§`, en:`(Life) Set 1-3 month goals aligned with your life path (#${lifeNum}).`});
  if (MASTERS.includes(nameNum) || MASTERS.includes(lifeNum)) plan.push({ hi:`Master number detected ‚Äî ‡§∞‡•ã‡§ú‡§º‡§æ‡§®‡§æ ‡§ß‡•ç‡§Ø‡§æ‡§®/reflect ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ mentor ‡§ñ‡•ã‡§ú‡•á‡§Ç‡•§`, en:`Master number detected ‚Äî practice daily reflection and seek mentorship.`});
  plan.push({ hi:`Daily: ‡§è‡§ï ‡§õ‡•ã‡§ü‡§æ actionable step ‡§≤‡•á‡§Ç ‡§î‡§∞ ‡§â‡§∏‡•á ‡§™‡•Ç‡§∞‡§æ ‡§ï‡§∞‡•á‡§Ç ‚Äî momentum ‡§Æ‡§ø‡§≤‡•á‡§ó‡§æ‡•§`, en:`Daily: take one small actionable step and complete it to build momentum.`});
  return plan.slice(0,5);
}

/* ---------- UI & Main ---------- */
function calculateAll() {
  const name = document.getElementById('nameInput').value.trim();
  const dob = document.getElementById('dobInput').value;

  if (!name && !dob) { alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§®‡§æ‡§Æ ‡§î‡§∞/‡§Ø‡§æ ‡§ú‡§®‡•ç‡§Æ‡§§‡§ø‡§•‡§ø ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç / Please enter name and/or DOB."); return; }

  const nameRes = calculateNameNumber(name);
  const lifeRes = calculateLifePathFromDate(dob);

  document.getElementById('result').style.display = 'block';
  document.getElementById('letters').innerHTML = name ? `<b>Letter Breakdown:</b> ${nameRes.breakdown.join(', ')}<br><small class="muted">‡§Ö‡§ï‡•ç‡§∑‡§∞ ‡§ï‡§æ ‡§Æ‡§æ‡§® / Letters values</small>` : `<b>Letter Breakdown:</b> (‡§®‡§æ‡§Æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç / name not provided)`;

  // Name display
  if (name) {
    const nm = nameRes.reduced;
    const masterNote = MASTERS.includes(nm) ? ` <span class="muted">(Master Number: ${nm})</span>` : '';
    document.getElementById('nameTotal').innerHTML = `<b>Name Total:</b> ${nameRes.total} ‚Üí <b>Name Number:</b> ${nm}${masterNote}`;
    const d = data[nm] || {};
    document.getElementById('meaningName').innerHTML = `<b>Meaning (Name ${nm}) ‚Äî ‡§π‡§ø‡§Ç‡§¶‡•Ä:</b> ${d.meaning_hi || '-'}<br><b>English:</b> ${d.meaning_en || '-'}<br><small class="muted">Suggested profession: ${d.profession || '-'}</small>`;
  } else { document.getElementById('nameTotal').innerHTML=''; document.getElementById('meaningName').innerHTML=''; }

  // Life display
  if (lifeRes) {
    const ln = lifeRes.reduced;
    const masterNoteL = MASTERS.includes(ln) ? ` <span class="muted">(Master Number: ${ln})</span>` : '';
    document.getElementById('lifeTotal').innerHTML = `<b>Life Path Sum:</b> ${lifeRes.sum} ‚Üí <b>Life Path Number:</b> ${ln}${masterNoteL}`;
    const d2 = data[ln] || {};
    document.getElementById('meaningLife').innerHTML = `<b>Meaning (Life ${ln}) ‚Äî ‡§π‡§ø‡§Ç‡§¶‡•Ä:</b> ${d2.meaning_hi || '-'}<br><b>English:</b> ${d2.meaning_en || '-'}<br><small class="muted">Suggested profession: ${d2.profession || '-'}</small>`;
  } else { document.getElementById('lifeTotal').innerHTML=''; document.getElementById('meaningLife').innerHTML=''; }

  // compatibility
  const nameNum = name ? nameRes.reduced : null;
  const lifeNum = lifeRes ? lifeRes.reduced : null;
  const comp = compatibilityAdvice(nameNum, lifeNum);
  document.getElementById('compat').innerHTML = `<b>Combined Guidance ‚Äî ‡§π‡§ø‡§Ç‡§¶‡•Ä:</b><br>${comp.hi.replace(/\n/g,'<br>')}<hr><b>Combined Guidance ‚Äî English:</b><br>${comp.en.replace(/\n/g,'<br>')}`;

  // lucky block
  const lucky = determineLucky(nameNum, lifeNum);
  if (lucky) {
    let html = `<b>Lucky Number(s):</b> `;
    if (lucky.secondaryNumber) html += `${lucky.primaryNumber} (primary), ${lucky.secondaryNumber} (secondary)`;
    else html += `${lucky.primaryNumber}`;
    html += `<br><div style="margin-top:8px;"><b>Lucky Color (Primary):</b> <span class="color-pill" style="background:${lucky.primaryColorHex}">${lucky.primaryColorHi} / ${lucky.primaryColorEn}</span>`;
    if (lucky.secondaryNumber) {
      html += `<br style="margin-top:8px;"><b>Lucky Color (Secondary):</b> <span class="color-pill" style="background:${lucky.secondaryColorHex || '#999'}">${lucky.secondaryColorHi || '-'} / ${lucky.secondaryColorEn || '-'}</span>`;
    }
    html += `</div><div style="margin-top:8px;"><small class="muted">${lucky.explanationHi}<br>${lucky.explanationEn}</small></div>`;
    document.getElementById('luckyBlock').innerHTML = html;
  } else {
    document.getElementById('luckyBlock').innerHTML = '';
  }

  // action plan
  const plan = generateActionPlan(nameNum, lifeNum);
  const planHiHtml = `<b>Action Plan ‚Äî ‡§π‡§ø‡§Ç‡§¶‡•Ä:</b><ul>${plan.map(p=>`<li>${p.hi}</li>`).join('')}</ul>`;
  const planEnHtml = `<b>Action Plan ‚Äî English:</b><ul>${plan.map(p=>`<li>${p.en}</li>`).join('')}</ul>`;
  document.getElementById('actionPlan').innerHTML = planHiHtml + "<hr>" + planEnHtml;
}

/* ---------- compatibility advice (simple) ---------- */
function compatibilityAdvice(nameNum, lifeNum) {
  if (!nameNum && !lifeNum) return { hi: "‡§°‡•á‡§ü‡§æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç‡•§", en: "No data available." };
  if (nameNum === lifeNum) {
    return { hi: `Name Number ‡§î‡§∞ Life Path Number ‡§¶‡•ã‡§®‡•ã‡§Ç ${nameNum} ‡§π‡•à‡§Ç ‚Äî ‡§∏‡§Æ‡§®‡•ç‡§µ‡§Ø ‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§π‡•à‡•§`, en: `Both numbers are ${nameNum} ‚Äî strong alignment.` };
  }
  if (MASTERS.includes(nameNum) || MASTERS.includes(lifeNum)) {
    return { hi: `‡§Æ‡§æ‡§∏‡•ç‡§ü‡§∞ ‡§®‡§Ç‡§¨‡§∞ ‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§π‡•à ‚Äî ‡§â‡§ö‡•ç‡§ö ‡§â‡§¶‡•ç‡§¶‡•á‡§∂‡•ç‡§Ø ‡§î‡§∞ ‡§ú‡§ø‡§Æ‡•ç‡§Æ‡•á‡§¶‡§æ‡§∞‡•Ä ‡§ï‡§æ ‡§∏‡§Ç‡§ï‡•á‡§§‡•§`, en: `A master number is present ‚Äî indicates higher purpose.` };
  }
  const friendlyPairs = [[1,5],[5,1],[2,6],[6,2],[3,9],[9,3],[4,8],[8,4],[7,7]];
  for (const p of friendlyPairs) if (p[0]===nameNum && p[1]===lifeNum) return { hi:`${nameNum} ‡§î‡§∞ ${lifeNum} ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø‡§§‡§É ‡§Æ‡•á‡§≤ ‡§ñ‡§æ‡§§‡•á ‡§π‡•à‡§Ç‡•§`, en:`${nameNum} and ${lifeNum} generally match well.` };
  return { hi:`‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§ú‡•Ä‡§µ‡§® ‡§™‡§• ‡§Æ‡•á‡§Ç ‡§ï‡•Å‡§õ ‡§≠‡§ø‡§®‡•ç‡§®‡§§‡§æ‡§è‡§Å ‡§π‡•à‡§Ç ‚Äî ‡§∏‡§Ç‡§§‡•Å‡§≤‡§® ‡§î‡§∞ ‡§Ö‡§®‡•Å‡§∂‡§æ‡§∏‡§® ‡§â‡§™‡§Ø‡•ã‡§ó‡•Ä ‡§∞‡§π‡•á‡§ó‡§æ‡•§`, en:`There are differences between name and life path ‚Äî balance and discipline will help.` };
}

/* ---------- Download / copy features ---------- */
async function downloadPDF(){
  const { jsPDF } = window.jspdf;
  const el = document.getElementById('result');
  const canvas = await html2canvas(el, { scale: 2, backgroundColor: null });
  const img = canvas.toDataURL('image/png');
  const pdf = new jsPDF('p','mm','a4');
  const pdfW = pdf.internal.pageSize.getWidth();
  const pdfH = (canvas.height * pdfW) / canvas.width;
  pdf.addImage(img, 'PNG', 0, 0, pdfW, pdfH);
  pdf.save('Numerology_Result.pdf');
}

async function downloadImage(){
  const el = document.getElementById('result');
  const canvas = await html2canvas(el, { scale: 2, backgroundColor: null });
  const link = document.createElement('a');
  link.download = 'Numerology_Result.png';
  link.href = canvas.toDataURL('image/png');
  document.body.appendChild(link);
  link.click();
  link.remove();
}

function copyResult() {
  const letters = document.getElementById('letters').innerText;
  const nt = document.getElementById('nameTotal').innerText;
  const lt = document.getElementById('lifeTotal').innerText;
  const mn = document.getElementById('meaningName').innerText;
  const ml = document.getElementById('meaningLife').innerText;
  const comp = document.getElementById('compat').innerText;
  const lk = document.getElementById('luckyBlock').innerText;
  const ap = document.getElementById('actionPlan').innerText;
  const text = [letters, nt, lt, mn, ml, comp, lk, ap].filter(Boolean).join('\n\n');
  navigator.clipboard.writeText(text).then(()=> { alert('Result copied to clipboard! / ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§ï‡•ç‡§≤‡§ø‡§™‡§¨‡•ã‡§∞‡•ç‡§° ‡§Æ‡•á‡§Ç ‡§ï‡•â‡§™‡•Ä ‡§π‡•ã ‡§ó‡§Ø‡§æ!'); })
  .catch(()=> { alert('Copy failed ‚Äî ‡§Ü‡§™ ‡§Æ‡•à‡§®‡•ç‡§Ø‡•Å‡§Ö‡§≤‡•Ä ‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§'); });
}

/* ---------- Theme persistence ---------- */
const themeBtn = document.getElementById('themeToggle');
function setThemeFromLocal() {
  const theme = localStorage.getItem('nm_theme') || 'dark';
  if (theme === 'light') { document.body.classList.add('light'); themeBtn.innerText = 'üåû Light'; }
  else { document.body.classList.remove('light'); themeBtn.innerText = 'üåô Dark'; }
}
function toggleTheme() {
  document.body.classList.toggle('light');
  const isLight = document.body.classList.contains('light');
  localStorage.setItem('nm_theme', isLight ? 'light' : 'dark');
  themeBtn.innerText = isLight ? 'üåû Light' : 'üåô Dark';
}
themeBtn.addEventListener('click', toggleTheme);
setThemeFromLocal();

</script>

</body>
</html>

